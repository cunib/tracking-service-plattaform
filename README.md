# Tracking Service Plattaform
Prototipo funcional el cual se focaliza en brindar servicios de seguimiento continuo de entregas de pedidos provistos por un local de comidas. El prototipo cuenta de tres partes,
una plataforma web [tracking-service-plattaform](https://github.com/cunib/tracking-service-plattaform) que se encargara de la lógica de negocio y servirá para mostrar el recorrido de los repartidores en un mapa, una aplicación móvil [Mobile-Tracking-App](https://github.com/marianoiglesiasmarchese/Mobile-Tracking-App) que representara a cada repartidor y permitirá recolectar su información a medida que este se va moviendo, por último, una API [tracking-service-plattaform](https://github.com/cunib/tracking-service-plattaform) que brindara acceso a parte de la lógica de negocio y servirá de interfaz de comunicación entre la plataforma web y la aplicación móvil.
# Sobre el prototipo
## Aplicación Web
La aplicación Web contiene la mayor parte de la lógica de negocio del prototipo. Esta aplicación Web se dividió en dos áreas funcionales, una destinada a la administración que representaría la
funcionalidad que requiere el negocio de repartos (backend) y otra enfocada a las necesidades de los clientes (frontend).  
![Image-4](https://github.com/cunib/tracking-service-plattaform/blob/master/public/readme_images/image-4.png)  
Desde el área de administración (backend) se pueden gestionar negocios, repartidores, entregas, ordenes, estrategias de gestión de caminos para una entrega y productos ofrecidos por cada negocio. También es posible visualizar en un mapa el recorrido de cada entrega, junto a la información de sus órdenes.
En esta misma área (backend) también es posible crear órdenes, provenientes, por ejemplo, de un pedido telefónico realizado por un cliente, permitiendo mantener una gestión de las mismas por parte del negocio de repartos. Entre las opciones de gestión, se encuentra la funcionalidad de cambiar los estados de cada orden, estos estados son determinantes para todo el proceso de seguimiento, ya que establecen en que momento está disponible una orden para formar parte de una entrega, el inicio de su seguimiento, la visibilidad de la información por parte del cliente, así como también el fin del seguimiento de la misma.
En la siguiente figura se pude apreciar el listado de órdenes de un negocio de repartos. Cada pedido (orden) se indica el nombre del cliente, la dirección de destino del pedido, el estado actual de la orden, y la lista de acciones que se pueden realizar. Estas acciones como se pueden observar en la figura pueden variar acorde al estado actual de la orden.  
![Image-1](https://github.com/cunib/tracking-service-plattaform/blob/master/public/readme_images/image-1.png)  
Se pueden apreciar en la siguiente figura, los iconos que representan las diferentes acciones disponibles por el negocio de repartos para aplicar sobre las ordenes (en la Figura 4.2 se mostró como estas acciones son visualizadas por el negocio). Se puede observar los iconos para las acciones “Ver detalles”, “Modificar” o “Borrar”, estas permiten ver detalles, modificar el pedido y borrar el mismo respectivamente. La opción “Procesar” permite indicar que la orden se encuentra en estado “Desarrollo”, con respecto a la acción “Marcar como enviado”, permite volver a marcar como "Enviada" a aquellas ordenes que se hallan suspendido durante su reparto. Por otro lado, “Lista para enviar” la da orden el estado “ListoParaEnviar” indicando que la misma se encuentra disponible para ser añadida a una entrega. Mientras que “Cancelar” y “Suspender” llevan la orden a los respectivos estados “Cancelado” y “Suspendido”.  
![Image-2](https://github.com/cunib/tracking-service-plattaform/blob/master/public/readme_images/image-2.png)  
Al dar de alta o editar conceptos que tienen asociado una dirección, como lo son una orden o un negocio de repartos, se utiliza la API Google Maps Geocoding [GoogleMaps] la cual, como se mencionó en la Sección 2.2.3, provee mediante el proceso de geocodificación 25 la funcionalidad de convertir direcciones en formato de texto en coordenadas geográficas, permitiéndonos guardar el par latitud-longitud asociado a la misma para luego ser usada en la lógica de posicionamiento. Si bien este cálculo se podría hacer cuando se necesite el par latitud-longitud y no guardarla, se decide almacenarlo ya que dicho proceso es costoso y haría más lento el cálculo de caminos al intentar realizar este cálculo para todas las órdenes involucradas en la entrega.  
En el área Web enfocada al cliente, es posible simular la generación de una orden de compra, eligiendo el negocio, distintos productos ofrecidos por este y proporcionando una dirección donde quiera recibir el pedido y datos referentes a quien realiza la compra. Esta funcionalidad crea una orden que se inicializa en estado “Creado”. Una vez registrada en el sistema, se le entregará un código único que sirve para que el cliente busque su orden y dependiendo del estado de la misma le permita ver distinta información asociada de ella. Como, por ejemplo, cambios de estado, así como también seguir su recorrido en un mapa cuando la misma este en estado de "Enviado".  
Una pantalla de ejemplo de la creación de una orden de pedido se puede apreciar en la siguiente figura. Se pueden observar los productos incorporados en la orden.  
![Image-3](https://github.com/cunib/tracking-service-plattaform/blob/master/public/readme_images/image-3.png)  
La aplicación Web recibe la posición del repartidor cada vez que se detecte un cambio en éste desde la aplicación móvil que tiene instalada en su celular. La posición junto a la fecha y hora en que se registró, es utilizada para crear un rastro que se asocia a la representación del repartidor en la aplicación Web, y en caso de que este tenga asignado un reparto activo 26 , también se creará otro rastro para éste (el cual se visualizará en la aplicación móvil). De esta manera, se muestra el recorrido continuo que va haciendo el repartidor junto con el sugerido por el sistema para la entrega que éste está realizando.  
Un negocio puede agrupar órdenes que estén en estado “ListoParaEnviar” conformando una entrega a la cual se le asocia un repartidor. Una vez creada la entrega y cuando el repartidor se encuentre listo para realizarla, esta se podrá poner en curso desde la administración del negocio de repartos, lo que generará que todas las ordenes asociadas a
la entrega pasen a estado "Enviado" y se establezca ese instante de tiempo como la fecha
de comienzo del reparto.  
El cliente puede seguir la evolución de su orden de pedido, al ingresar el código único que se entregó al generar el pedido, donde solo puede ver información de su orden y en caso de que el estado lo permita el recorrido de la misma, pero no puede ver información ni el recorrido de las demás ordenes de la entrega.  
En la siguiente figura se puede apreciar la información que puede observar el cliente en relación a su orden de pedido. En este caso, como el estado de la orden es “Creado” el usuario no puede visualizar el recorrido del repartidor aún.  
![Image-5](https://github.com/cunib/tracking-service-plattaform/blob/master/public/readme_images/image-5.png)  
Una vez que las ordenes asociadas a la entrega pasen a estado "Enviado" y se establezca ese instante de tiempo como la fecha de comienzo del reparto. En este momento es cuando los clientes comenzaran a ver el recorrido que realiza su pedido en un mapa de Google Maps, este recorrido será visible hasta que la orden sea entregada y pase al estado de "Finalizada", o hasta que la misma sea cancelada y pase al estado “Cancelado”, momento en el cual ya no se podrán ver información de posicionamiento. A su vez, desde el negocio de repartos se puede seguir el recorrido completo de la entrega hasta que la misma finalice.  
En la figura a continuación se puede apreciar como el cliente puede visualizar el mapa asociado a su orden de pedido cuando el mismo tiene estado “Enviado”. De esta manera, el usuario puede visualizar en tiempo real donde está el repartidor que hará entrega de su pedido, y el camino que el mismo viene realizando.  
Por ahora el prototipo no informa cuantos pedidos faltan entregar antes de que le llegue el turno al usuario, pero esta información podría ser útil en un futuro para tener una estimación más real del tiempo que puede demorar el pedido en ser entregado.  
![Image-6](https://github.com/cunib/tracking-service-plattaform/blob/master/public/readme_images/image-6.png)  
El negocio de repartos, para el prototipo implementado, tiene la capacidad de elegir entre dos estrategias de búsquedas de caminos, la estrategia elegida va a ser utilizada cuando se genera el recorrido recomendado que vera el repartidor en su aplicación móvil al momento de distribuir cada entrega, este recorrido esta armado a partir de los destinos de cada una de las ordenes que la componen. Este cálculo se realiza del lado del Servidor, con el fin de aliviar de carga de procesamiento y de cálculo en el dispositivo móvil del repartidor.  
Para ambas estrategias, el algoritmo utilizado tiene en cuenta la dirección del negocio de repartos como punto de partida y destino (para que también se calcule la vuelta al negocio de repartos) y como puntos intermedios, las direcciones destino de las ordenes que se encuentren en estado "Enviado".  
Las estrategias implementadas en el prototipo son las siguientes:  
* Algoritmo de grafos TSP (Travelers Salesman Problem) el cual se desarrolla a partir de una variante de Dijkstra propuesta en [Kuo-pao Yang et al., 2015]. Este algoritmo es conocido como el problema del viajante [Applegate et al., 2011] y responde a la siguiente pregunta general: dada una lista de ciudades y las distancias entre cada par de ellas, ¿Cuál es la ruta más corta posible que visite cada ciudad exactamente una vez y finaliza al regresa a la ciudad origen?. Esto fue implementado, en particular, considerando el camino más corto para entregar todos los pedidos de la entrega.  
En particular, esta estrategia utiliza las distancias entre las direcciones mencionadas anteriormente (como origen y destino la dirección del negocio, y las direcciones de las ordenes como puntos intermedios). Estas distancias son obtenidas a través de sus coordenadas longitud-latitud utilizando la API Google Maps Distance Matrix, la cual permite obtener la distancia entre un punto orígenes y destino a partir de su longitud y latitud. Estas distancias, sirven de ponderación que ayudan al algoritmo para determinar el camino recomendado.  
* Algoritmo Random, este surge con el fin de poder proveer otra alternativa de estrategia y así poder probar el funcionamiento del cambio de estrategias para calcular caminos. En este caso, el orden de los destinos se establece de forma aleatoria. Si bien es una estrategia ineficiente para este domino, en este prototipo por simplicidad se decidió implementarla a fines prácticos de las pruebas de funcionalidad.  
Como resultado de cualquiera de las dos estrategias se obtiene una lista ordenada de las órdenes que serán enviadas a la aplicación móvil del repartidor cuando este consulte por la entrega activa. Cada reparto guarda una referencia a la estrategia con que fue calculado el recorrido de la misma.  
Una vez que se cuenta con la lista de órdenes procesada por el algoritmo de la estrategia elegida, tanto la aplicación móvil (del repartidor) como el negocio de repartos, las utilizaran para mostrar el recorrido recomendado al repartidor. Adicionalmente, el negocio de repartos, puede ver en el mismo mapa el recorrido real realizado por el repartidor para dicha entrega. En la siguiente figura se observa la perspectiva que puede apreciar un negocio al inspeccionar el detalle de una entrega. En particular, se muestra en el mapa el recorrido sugerido a partir de una estrategia elegida, y además el camino real realizado por el repartidor.  
![Image-7](https://github.com/cunib/tracking-service-plattaform/blob/master/public/readme_images/image-7.png)  
### Importante
Existe una limitante en cuanto a la cantidad de órdenes que se le puede asociar a un reparto, debido a que la versión gratuita de la API de Google Maps usada en este prototipo establece un límite de 23 posiciones como máximo por petición para armar los recorridos. Como los recorridos se armarán a partir de las posiciones de cada orden del reparto más la posición del negocio como inicio y fin (serían dos posiciones más), con lo cual como máximo se puede asociar a un reparto 21 órdenes de pedido.  
